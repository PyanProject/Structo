# Распределенная система генерации 3D-моделей

Система позволяет генерировать 3D-модели по текстовым описаниям (промптам), используя 
модуль Shape-E. Генерация происходит на локальном компьютере с CUDA-совместимой видеокартой,
а веб-интерфейс размещен на VDS сервере.

## Обзор системы

Система состоит из двух основных компонентов:

1. **API-сервер на локальном ПК** - выполняет генерацию 3D-моделей с использованием GPU
2. **Веб-приложение на VDS** - предоставляет интерфейс для пользователей и отправляет запросы на генерацию

## Настройка локального ПК

### Требования к системе

- Python 3.8 или выше
- CUDA-совместимая видеокарта (NVIDIA) с 6+ ГБ VRAM
- CUDA 11.7+ и cuDNN
- 8+ ГБ RAM
- PyTorch с поддержкой CUDA

### Установка

1. Клонируйте репозиторий на локальный ПК:

```bash
git clone https://your-repo-url.git
cd структо-локальный
```

2. Установите необходимые зависимости:

```bash
pip install -r requirements.txt
```

3. Настройте файл конфигурации на локальном ПК:

```python
# config.py
# Порт, на котором будет работать API-сервер
LOCAL_PC_PORT = 5678
```

4. Убедитесь, что порт открыт в брандмауэре и доступен для доступа извне.

5. Запустите API-сервер:

```bash
python shape_server.py
```

## Настройка VDS сервера

### Требования к системе

- Python 3.8 или выше
- Flask и зависимости
- Доступ к локальному ПК через интернет

### Установка

1. Клонируйте репозиторий на VDS:

```bash
git clone https://your-repo-url.git
cd структо-сервер
```

2. Установите необходимые зависимости:

```bash
pip install -r requirements.txt
```

3. Настройте файл конфигурации на VDS, указав IP-адрес вашего локального ПК:

```python
# config.py
LOCAL_PC_IP = "ваш-внешний-ip-адрес"  # IP-адрес вашего локального ПК
LOCAL_PC_PORT = 5678  # Порт, на котором работает API-сервер
```

4. Проверьте соединение с локальным ПК:

```bash
python test_connection.py
```

5. Запустите веб-приложение:

```bash
python app.py
```

## Тестирование системы

1. Откройте веб-интерфейс в браузере (http://ваш-vds-ip:5000)
2. Введите простой промпт, например "red sphere"
3. Нажмите кнопку генерации
4. Система должна отправить запрос на локальный ПК, сгенерировать модель и показать ее в интерфейсе

## Настройка постоянной работы

### На локальном ПК

Для того чтобы API-сервер работал постоянно, можно использовать systemd (Linux) или nssm (Windows).

#### Linux (systemd)

Создайте файл сервиса:

```bash
sudo nano /etc/systemd/system/shape-server.service
```

Содержимое:

```ini
[Unit]
Description=Shape-E API Server
After=network.target

[Service]
User=your-username
WorkingDirectory=/path/to/structo
ExecStart=/usr/bin/python3 /path/to/structo/shape_server.py
Restart=always
RestartSec=5

[Install]
WantedBy=multi-user.target
```

Запустите сервис:

```bash
sudo systemctl enable shape-server
sudo systemctl start shape-server
```

#### Windows

1. Установите NSSM (Non-Sucking Service Manager):
   https://nssm.cc/download

2. Откройте командную строку от имени администратора и выполните:

```bash
nssm install ShapeServer
```

3. В появившемся окне настройте пути к исполняемому файлу Python и скрипту shape_server.py

### На VDS

Аналогично настройте сервис для app.py на VDS сервере.

## Устранение неполадок

1. **Не удается подключиться к API-серверу:**
   - Проверьте, открыт ли порт в брандмауэре
   - Убедитесь, что IP-адрес в config.py верный
   - Попробуйте использовать VPN или туннелирование, если ваш провайдер блокирует порты

2. **Ошибки при генерации моделей:**
   - Проверьте наличие CUDA и совместимость версий с PyTorch
   - Убедитесь, что видеокарта поддерживается и имеет достаточно VRAM
   - Проверьте логи на локальном ПК для более подробной информации

3. **Медленная генерация моделей:**
   - Используйте более мощную видеокарту
   - Уменьшите сложность промптов
   - Оптимизируйте параметры генерации в файле shape_server.py

## Дополнительные настройки

- Для улучшения безопасности рекомендуется настроить аутентификацию API и HTTPS
- Для обработки большого количества запросов можно настроить очередь задач
- Для ускорения генерации можно оптимизировать параметры модели

## Структура проекта

```
├── app.py                # Основное Flask-приложение на VDS
├── config.py             # Настройки соединения
├── remote_generator.py   # Модуль для взаимодействия с удаленным генератором
├── shape_server.py       # API-сервер для локального ПК
├── static/               # Статические файлы веб-приложения
│   ├── scripts.js        # JavaScript для клиентской части
│   └── styles.css        # CSS стили
├── templates/            # HTML шаблоны
│   └── main_page.html    # Главная страница
├── test_connection.py    # Скрипт для проверки соединения
└── README.md             # Документация
``` 